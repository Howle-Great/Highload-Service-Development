## Highload Service Development

### 1. Тема: Стриминговый аудио сервис
<https://music.yandex.ru/>

### 2. Определение возможного диапазона нагрузок подобного проекта

Взяв в расчет данные из [Яндекс.Радара](https://radar.yandex.ru/top_list?thematic=culture%2Cmusic)  за 2019 год, можно сказать, что сервис имеет следующую статистику по пользователям: 
* 25 млн. п./месяц
* 2 млн. п./день
* 187 минут (среднее время проведенное на сервисе)



### 3. Выбор планируемой нагрузки как 30% доля рынка в России

В данный момент средний пользователь сервиса слушает по 187 минут аудиоконтента в день, среднее количество пользователей на сервисе за день состовляет 2 миллиона. Из этого можно сделать вывод, что:

Одна минута песни в максимальном качетсве весит: 

Берем по максимуму 320(битрейт) * 60(сек) = 19200 Кбит / 8 = 2400 КБайт ~ 2,344 МБ 

Но тк большая часть музыки передается пользователям с битрейтом 192, то предлагается взять среднюю величину и скачать что это будет являться максимально возможным весом песни. Кроме того сервис может так же регулировать нагрузку на сервера и при необходимости снижать битрейт.

Минимальный вес 192(битрейт) * 60(сек) = 11400 Кбит / 8 = 1425 КБайт ~ 1,391 МБ

Предположем, что у нас в сервисе в среднем имеется 50% музыке с 192 битрейтом и столько же в 320%, а также, что пользователь равновероятно будет слушать и ту и другую музыку имеем (в реальность намного больше доли песен с 192 битрейтом):

Средний вес одной песни: (2,344 + 1,391)/2 ~ 1,867 МБ (1 минута музыки)

Значит средний пользователь скачивает максимольно:

187(минут на сервисе) * 1,867(МБ) = 349,129 МБ аудиоконтента

В среднем за день скачивается с нашего сервиса максимально скачивается:

349.129(МБ) * 2000000(пользователей) = 698 258 000 МБ музыки ~ 666 ТБайт музыки 

С учетом того, что дневной пик = 2,5 * (среднюю нагрузку) имеем:

дневной пик = 2,5 * (2000000/24(Среднее кол-во пользователей в час)) ~ 208 334 человек/час

Нагрузка в дневной пик = 349,129(МБ) * 208334(человек/час) ~ 72 735 441 МБ = 69,365 ТБайт/час

Нагрузка на добавление песен можно не учитывать тк она достаточно мала и не существенна по сравнению с нагрузкой на отдачу мызыки

### 4. Логическая схема базы данных (без выбора СУБД)
![](./img/схема.png)

### 5. Физическая системы хранения (конкретные СУБД, шардинг, расчет нагрузки, обоснование реализуемости на основе результатов нагрузочного тестирования)

Для сервися аутефикации будет использоваться:
СУБД: Tarantool

Для сервиса пользовательской музыки:
СУБД: PostreSQL

Для сервиса музыки:
СУБД: PostreSQL